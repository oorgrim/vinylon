{% extends 'base.html' %}
{% load i18n %}

{% block content %}
    <div class="media_body">
        {% for vinyl in vinyls %} 
            <div class="{{vinyl.title}}">
                <img src="/media/{{vinyl.cover}}">
                {{vinyl.title}}
                {% for audio in audiofiles%}
                    {% if audio.vinyl_record.title == vinyl.title%}
                        <div class="song" onclick="sendValue(this)">
                            <p>{{ audio.title }}</p>
                            <p style="display: none;">{{ audio.audio_file }}</p>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endfor %}   
    </div>
    <hr>   
    {% for audio in audiofiles%}
        <audio controls>
            {{ audio.audio_file }}
            <source src="/media/{{ audio.audio_file }}" type="audio/mpeg">
        </audio>
    {% endfor %}   
    <script>
        audios = document.getElementsByTagName("source")  

        window.onload = function(){
            for(let i = 0; i < audios.length; i++){
                audios[i].parentElement.setAttribute('style', 'display:none')
            }

            ulList = document.getElementsByTagName("ul")
            for(let i = 0; i < ulList.length; i++){
                if(ulList[i].children.length <= 1){
                    ulList[i].setAttribute('style', 'display:none;')
                }
                else{
                    ulList[i].setAttribute('style', 'display:block;')
                }
            }
        }
        function sendValue(song){
            songContainers = document.getElementsByClassName("song")
            for(let i = 0; i < songContainers.length; i++){
                songContainers[i].setAttribute('style', 'color:black')
            }
            song.setAttribute('style', 'color:blue')
            for(let i = 0; i < audios.length; i++){
                console.log("http://127.0.0.1:8000/media/" + song.children[1].innerHTML)
                console.log(audios[i].src)
                if("http://127.0.0.1:8000/media/" + song.children[1].innerHTML == audios[i].src){
                    audios[i].parentElement.setAttribute('style', 'display:block')
                    console.log(audios[i].src)
                }
                else{
                    audios[i].parentElement.setAttribute('style', 'display:none')
                }
            }            
        }
    </script>
{% endblock %}